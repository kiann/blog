## （2018-4-21）关于最近Android（伪）组件化的教训和总结

![背景](static/img/2018-4-21-bg.jpg)

>所在小组维护的Android客户端，从最初丑陋的只有三五个页面的第一版客户端，发展到现在工程十来个G，安装包三十多M的程度，一共用了三年多，其中还进行过一次大改版（虽然并不彻底）。

>工程大了，分支多了，产出也从一个apk发展到现在各种定制各种版本，维护起来力不从心，各种问题亟待解决。所以被安排了此次组件化整理。

### **但是事实证明这是一次失败的组件化经历...**

先列一下整理出来的需要解决或者期望通过组件化来解决的问题

* 一个分支变成多个分支，大量代码重复，bug修复困难
* 代码冗余，资源文件、xml布局文件和java源码中都存在废弃代码
* 框架过重，启动缓慢，应用体积巨大，打包编译缓慢
* so文件太多，目前已经达到30来个
* http请求大量使用明文传输，且没有鉴权
* 没有日志收集机制
* 。。。

那么经过一个来月的整理以及所谓的“组件化”之后，以上的问题解决了多少呢？答案是：零。

首先不提组件化的实现方式，组件化的过程之类的，这些东西各家有各家的实现方式，没有定型，只要能很好的解决痛点就好。我想记录的是为什么这次组件化是失败的。

>1、时间、(~~钱~~)资源和人力：不可调和的矛盾

最开始的时候，我们都是底层程序员，每天都工作就是领活、干活、提交，不断的循环，而我们的能力和经验就在这样的循环中提高，但我们不会考虑合理性而只考虑技术实现的可行性，能做出来就行。

当我们再往上一步的时候，我们接触了需求，甚至接触了一些管理，每天要做的事情除了干活之外，还需要做需求，需要派活给别人，需要管理进度。我们开始从业务上考虑该怎么做，而不仅仅是能不能做。

这时候，时间、资源和人力之间的矛盾就出来了，这三者总是至少有一个不够用，而大部分情况下是都不够用。我们能做的就是在着三者之间不断协调和平衡。而同样的：时间和人力与最终效果之间，也是不可调和的矛盾，想要用10个人一个月完成别人50个人一年的效果，只能是在其他不断的地方埋下各种深坑。

回到这次的组件化，代码量之多，远远不是三个人两周能够完成的，但是却被安排必须要完成，怎么办。好说，换汤不换药，不去重构任何代码，能够拆开的拆开，耦合严重的就整个复制过来。现在，我们得到了一份比原来更加难以维护的代码。

一开始的时候我是抱着解决所有问题的想法上手的；而到了中间，听多了时间不够人力不够以后再做这样的话，我是抱着能改多少改多少的问题来的；到了最后，时间越来越紧迫穿插进来的其他任务越来越多，我是抱着cv大法好，能跑起来不出错进行的。

怪我不上心么，怪一起的同事不给力么，怪组件化的方案不可行么，都不是。说白了还是不重视，既然现在的流程能够产出那就行了，虽然小问题多点，修修补补就好了，重构多废人废事占工期啊，有这时间不如多接项目。这是很普遍的想法，而想要靠大量的像我这样的底层程序员自下而上的主动去重构代码去解决这些问题，何其难也。

一边是紧张的工期和粗糙的要求，一边是内心的纠结，太耗费心思了。明明连自己都不看好这样粗制滥造的组件化架构能有什么作用，还不得不紧赶慢赶的去完成，这对于有编程洁癖的人实在是一种煎熬。

废话有点多，牢骚也有点多，说别的吧。

>2、less is more：很多地方都适用

这一条好理解，我只想说的是：

* 代码--该删就删，留着无用；
* 功能--不是什么都放到app上最好，那么多靠堆砌功能和链接起家的网站现在都学会精简了；
* 成员--少而精唯一的办法，十个人用1周并不能达到1个人用10周做到的程度，相反徒增管理压力。

>3、不断更新，不断重构，而且要主动

最开始的时候，我们对一个应用一个架构寄予了最高的期望，它是完美的是成熟的是last one。然后我们不断的添砖加瓦，不断的加界面加功能加逻辑，维护的人也从三两个变成十几甚至几十，谁都在上面做改动。渐渐的，架构被改的面目全非，谁都有贡献也谁都没办法理解全部逻辑，各种硬编码、各种假单例。它们就像是PCB板上千奇百怪的飞线，就像高档公寓里的私搭违建。这是为什么呢，这一切又是怎么开始的呢？难道说这是个无解的问题么，任何代码维护一段时间后就必须要重构不可么？

我觉得是。

万事万物在变，代码在变，需求在变，实现方式在变，界面效果主流体验也在变，我们的代码也得变，这就像是细胞的更新换代，就像是行业和市场的兴衰，谁也不能保证20年前造的汽车满足今天的用户，同样谁也不能保证3年前的代码满足现在的客户想法。而重点是：**被动还是主动**。

很遗憾，我所在的小组已经习惯了被动的改变，eclipse ADT停止维护没有新版本插件的时候才不得不考虑全体转到Android Studio；NDK 10版本太低结局不了新产生的问题的时候才考虑用更高的r14；代码复杂到维护不了的时候才考虑做组件化；甚至在地第二版客户端的时候，还舍不得重构舍不得旧代码，不断的复制粘贴，再节省人力和时间的同时，也把第一版的坑留了下来。


----

今天写的东西对开发一点用处都没有，完全就是牢骚和抱怨，我只是稍微理智的发泄了一下。不幸看到这一篇的各位我只能说声抱歉，浪费了你十几分钟的时间。

牢骚说完生活还得继续，工作还是要做，只能说少想多做了，不能得难受死。